<html>
  <head>
      <meta charset="utf-8">
      <title>Battleship</title>
  </head>
    <body>
    <table border=1>
      <tr>
	<th></th>
	<th> 1</th>
	<th> 2</th>
	<th> 3</th>
	<th> 4</th>
	<th> 5</th>
	<th> 6</th>
	<th> 7</th>
	<th> 8</th>
	<th> 9</th>
	<th>10</th>
      </tr>
      <tr>
	<th>A</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>B</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>C</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>D</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>E</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>F</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>G</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>H</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>I</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
      <tr>
	<th>J</th>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
      </tr>
    </table>
    <script
      src="https://code.jquery.com/jquery-3.2.1.js"
      integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
      crossorigin="anonymous"></script>
    <script>
    var gGame;

    function cell2String(obj) {
	if (!obj.tag || obj.tag !== "Vacant")       { return "?"; }
	if (obj.contents === null) {
	    return "<input type=checkbox>";
	}
	else if (obj.contents === true) {
	    return "<input type=checkbox value=checked disabled>";
	} else {
	    return "<input type=checkbox disabled>";
	}
    }

    function newGamePromise() {
    	return $.post("/game");
    }


    function refreshRow(row, rowIndex) {
	//console.log("row", rowIndex, "=", JSON.stringify(row));
	var refreshCell = function(cell, colIndex) {
	    console.log("cell [" + rowIndex + "," + colIndex + "] =",
	    		JSON.stringify(cell));
	    $($("table tbody tr")[rowIndex + 1].children[colIndex + 1])
		.html(cell2String(cell));
	};
	row.forEach(refreshCell);
    }

    function refreshGame(game) {
	gGame = game;
	if (game && game.board && game.board.board) {
//	    console.log(JSON.stringify(game.board.board));
	    game.board.board.forEach(refreshRow);
	} else {
	    console.log("unexpected: " + JSON.stringify(game));
	}
    }

    function xhrFail(xhr, status, errorThrown ) {
	alert( "Sorry, there was a problem!" );
	console.log( "Error: " + errorThrown );
	console.log( "Status: " + status );
	console.dir( xhr );
    }

$(document).ready(function() {
    newGamePromise()
	.done(refreshGame)
	.fail(xhrFail);
});
    </script>
</body>
</html>
    
